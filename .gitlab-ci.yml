image: 10.0.0.101:5000/ubuntu-loaded

stages:
  - verify
  - update
  - install
  - graduate

build:
  stage: verify
  tags:
    - docker
  script:
    - git checkout "$CI_COMMIT_BRANCH"
    - sh init-all.sh
    - sh build-all.sh

test-software-slow:
  stage: verify
  tags:
    - docker
  script:
    - git checkout "$CI_COMMIT_BRANCH"
    - sh init-all.sh
    - sh build.sh
    - sh test.sh slow
    
test-software-slow:
  stage: verify
  tags:
    - docker
  script:
    - git checkout "$CI_COMMIT_BRANCH"
    - sh init-all.sh
    - sh build.sh
    - sh test.sh unit
    - sh test.sh fast

deploy-update-staging:
  stage: update
  tags:
    - docker
  script:
    - git checkout "$CI_COMMIT_BRANCH"
    - sh deploy-dev-update.sh

deploy-staging:
  stage: install
  tags:
    - docker
  script:
    - git checkout "$CI_COMMIT_BRANCH"
    - sh deploy-dev.sh

graduate:
  stage: graduate
  tags:
    - docker
  script:
    - git checkout "$CI_COMMIT_BRANCH"
    - sh clean.sh
    - sh graduate.
  dependencies:
    - build


