image: 10.0.0.101:5000/ubuntu-loaded

stages:
  - build
  - verify
  - release
  - update
  - install
  - graduate


build-sketches:
  stage: build
  tags:
    - docker
  script:
    - git config --global user.email "compulsivecoder@gmail.com"
    - git config --global user.name "CompulsiveCoder"
    - git checkout "$CI_COMMIT_BRANCH"
    - git pull
    - sh init-sketches.sh
    - echo "..." #sh build-sketches.sh
    
build:
  stage: build
  tags:
    - docker
  script:
    - git config --global user.email "compulsivecoder@gmail.com"
    - git config --global user.name "CompulsiveCoder"
    - git checkout "$CI_COMMIT_BRANCH"
    - git pull
    - sh init.sh
    - sh init-apps.sh
    - sh init-tests.sh
    - sh build-cli.sh
    - sh build-tests.sh
  artifacts:
    paths:
      - lib/**
      - bin/Release/**
      - scripts/apps/**

build-www:
  stage: build
  tags:
    - docker
  script:
    - git config --global user.email "compulsivecoder@gmail.com"
    - git config --global user.name "CompulsiveCoder"
    - git checkout "$CI_COMMIT_BRANCH"
    - git pull
    - sh init-www.sh
    - sh build-www.sh
  artifacts:
    paths:
      - www/SystemManagerWWW/lib/**
      - www/SystemManagerWWW/src/GrowSense.SystemManager.WWW/bin/**


test-software-slow:
  stage: verify
  tags:
    - docker
  script:
    - git checkout "$CI_COMMIT_BRANCH"
    - sh test.sh slow
  dependencies:
    - build
    
test-software-fast:
  stage: verify
  tags:
    - docker
  script:
    - git checkout "$CI_COMMIT_BRANCH"
    - sh test.sh fast
  dependencies:
    - build
    
test-software-unit:
  stage: verify
  tags:
    - docker
  script:
    - git checkout "$CI_COMMIT_BRANCH"
    - sh test.sh fast
  dependencies:
    - build
    
release:
  stage: release
  tags:
    - docker
  script:
    - git config --global user.email "compulsivecoder@gmail.com"
    - git config --global user.name "CompulsiveCoder"
    - git checkout "$CI_COMMIT_BRANCH"
    - git pull
    - bash create-release-zip.sh
    - bash publish-github-release.sh
  dependencies:
    - build
    - build-www

deploy-update-staging:
  stage: update
  tags:
    - docker
  script:
    - git checkout "$CI_COMMIT_BRANCH"
    - echo "Skipping update" # sh deploy-dev-update.sh

deploy-staging:
  stage: install
  tags:
    - docker
  script:
    - git checkout "$CI_COMMIT_BRANCH"
    - sh deploy-dev.sh

graduate:
  stage: graduate
  tags:
    - docker
  script:
    - git checkout "$CI_COMMIT_BRANCH"
    - sh clean.sh
    - sh graduate.
  dependencies:
    - build




